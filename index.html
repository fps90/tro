<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Are you Ø²ÙˆØ²ÙŠ?</title>
<style>
  :root {
    --bg: #0b0e14;
    --fg: #f7f7fb;
    --muted: #c7c9d3;
    --accent: #ff5a7a;
    --shadow: rgba(0,0,0,0.45);
    --line-height: 1.5;
  }

  html, body {
    height: 100%;
    background: radial-gradient(1200px 800px at 50% 0%, #101527 0%, #0b0e14 42%, #07090d 100%);
    color: var(--fg);
    margin: 0;
    -webkit-text-size-adjust: 100%;
    font-family: "Tajawal", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Arabic", "Cairo", sans-serif;
  }

  .stage {
    position: fixed; inset: 0;
    display: grid; place-items: center;
    padding: clamp(16px, 2vw, 32px);
  }
  .card {
    text-align: center;
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 20px;
    box-shadow: 0 10px 30px var(--shadow);
    padding: clamp(20px, 3vw, 32px) clamp(18px, 3vw, 28px);
    width: 70vw;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
  .heart {
    width: clamp(68px, 10vw, 96px);
    height: clamp(68px, 10vw, 96px);
    display: inline-grid; place-items: center;
    margin: 6px auto clamp(12px, 2.2vw, 22px);
    border-radius: 50%;
    background: radial-gradient(closest-side, #ff92a6, #ff5a7a 60%, #e64562 100%);
    box-shadow: 0 12px 28px rgba(255,90,122,0.45), inset 0 -8px 18px rgba(0,0,0,0.25);
    cursor: pointer;
    transition: transform 180ms ease, filter 180ms ease;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }
  .heart:active { transform: scale(0.96); filter: brightness(0.98); }
  .heart svg { width: clamp(36px, 5vw, 52px); height: clamp(36px, 5vw, 52px); fill: white; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.25)); }

  .q { font-size: clamp(18px, 3vw, 36px); line-height: 1.35; margin-bottom: clamp(4px, 1.2vw, 10px); }
  .sub { font-size: clamp(12px, 1.6vw, 18px); color: var(--muted); }

  .rotate {
    position: fixed; inset: 0;
    display: none;
    background: rgba(0,0,0,0.45);
    color: var(--fg);
    align-items: center; justify-content: center;
    text-align: center; padding: 24px; z-index: 20;
  }
  .rotate-inner {
    background: rgba(12,14,22,0.65);
    border: 1px solid rgba(255,255,255,0.12);
    padding: 18px 20px;
    border-radius: 16px;
    max-width: 420px; width: min(92vw, 480px);
    box-shadow: 0 10px 30px var(--shadow);
  }

  .player { position: fixed; inset: 0; display: none; background: black; }
  video {
    position: absolute; inset: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    background: black;
  }

.ticker-wrap {
  position: fixed;           /* fixed instead of absolute â†’ stays pinned */
  left: 0;
  right: 0;
  bottom: 40px;              /* fixed offset from the bottom of screen */
  display: flex;             /* centers content horizontally */
  justify-content: center;

  background: none;          /* removes full overlay shadow */
  pointer-events: none;      /* prevents interaction blocking */
  z-index: 50;               /* ensures it's above video but below UI overlays */
}

.ticker {
  direction: rtl;
  margin: 0 auto;
  width: clamp(320px, 96vw, 720px);
  max-height: calc(4 * 1em * var(--line-height) + 16px);
  overflow: hidden;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.20);
  background: rgba(15, 15, 25, 0.75); /* cleaner translucent bar */
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.45);
  padding: 10px 14px;
  scroll-behavior: smooth;
  pointer-events: auto; /* allow text selection or copy if needed */
}

  /* Ensure typed line appears inline so the cursor sits right next to it */
  
  .typed-line {
  /* inline keeps the cursor directly adjacent to the last glyph */
  display: inline;
  white-space: pre-wrap;          /* keep newlines */
  overflow-wrap: anywhere;        /* prevent overflow during typing */
  line-height: var(--line-height);
  font-size: clamp(16px, 2.2vw, 22px);
  color: #fff;
  text-shadow: 0 2px 8px rgba(0,0,0,0.65);
  margin: 0;                      /* remove any accidental spacing */
}

.cursor {
  display: inline-block;
  width: 1px;
  height: 1em;
  background: #fff;
  vertical-align: -0.1em;
  margin-inline-start: 1px;       /* super tight gap to text (RTL-safe) */
  animation: blink 1s steps(2, end) infinite;
}

  @keyframes blink {
    0%,49% {opacity:1;}
    50%,100% {opacity:0;}
  }

  .hidden {display:none!important;}
  @media (pointer:coarse){.heart{cursor:default;}}

  /* Removed the rule that hid the stage in landscape to support laptops/desktops */
  /* @media (orientation: landscape){.stage{display:none;}} */
  .blocktext {
  position: fixed;
  /* center horizontally without needing a wrapper */
  left: 50%;
  transform: translateX(-50%);

  /* fixed distance from the bottom (change 40px as you like) */
  bottom: 40px;

  /* box size & scrolling */
  width: clamp(320px, 96vw, 720px);
  max-height: 2rem;         /* your 160px window */
  overflow: auto;

  /* look & feel (subtitle bar) */
  direction: rtl;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.20);
  background: rgba(15,15,25,0.75);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.45);
  padding: 10px 14px;

  /* allow selection/copy */
  pointer-events: auto;
  z-index: 50;
}
#btn-make {
  bottom: 200px;
  right: 30px;
  background-color: rgba(0, 0, 0, 0.3);
}

@keyframes floatIn {
  0% { transform: scale(0.95); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.div_btn {
  position: fixed;
  cursor: pointer;
  width: 55px;
  height: 55px;
  border: 3px solid #fff;
  border-radius: 50%;
  font-size: 2em;
  line-height: 58px;
  text-align: center;
  z-index: 999;
}
#div_support {
  bottom: 80px;
  right: 20px;
  background-color: rgba(0, 0, 0, 0.3);
}
</style>
<style>
        /* Preview Banner */
        .preview-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #dc3545;
            color: white;
            text-align: center;
            padding: 12px 50px 12px 20px;
            font-weight: bold;
            z-index: 9999;
            font-size: 14px;
            animation: slideDown 0.4s ease-out;
            font-family: 'Arial', sans-serif;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(-100%);
                opacity: 0;
            }
        }

        .preview-banner-text {
            display: inline-block;
            max-width: calc(100% - 60px);
            line-height: 1.4;
        }

        .preview-banner-close {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.25);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-banner-close:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-50%) rotate(90deg);
        }

        body.preview-active {
            padding-top: 50px;
        }

        /* Mobile responsiveness */
        @media (max-width: 600px) {
            .preview-banner {
                font-size: 12px;
                padding: 10px 45px 10px 15px;
            }
            
            body.preview-active {
                padding-top: 45px;
            }
        }

        @media (max-width: 400px) {
            .preview-banner {
                font-size: 10px;
                padding: 8px 40px 8px 12px;
            }
            
            body.preview-active {
                padding-top: 40px;
            }
        }
    </style>
</head>
<body>


  <div class="stage" id="stage" aria-live="polite">
  <div class="card">
    <button class="heart" id="heartBtn" aria-label="Ø§Ø¨Ø¯Ø¦ÙŠ" title="Ø§Ø¶ØºØ·ÙŠ Ù„Ù„Ø¨Ø¯Ø¡">
      <!-- Stylish free inline heart SVG (keeps behaviour via id="heartBtn") -->
      <svg viewBox="0 0 24 24" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg">
        <defs>

        </defs>
        <!-- Main filled heart shape using gradient -->
        <path d="M12.1 21.35l-1.1-.99C5.14 15.36 2 12.28 2 8.5 2 6 4 4 6.5 4c1.74 0 3.41.81 4.5 2.09C12.09 4.81 13.76 4 15.5 4 18 4 20 6 20 8.5c0 3.78-3.14 6.86-8.9 11.86l-1 .99z" fill="url(#gradHeart)" />
        <!-- Subtle highlight for depth -->
        <path d="M12.1 19.5l-.9-.8C6.9 14.2 4 11.7 4 8.5 4 6.7 5.7 5 7.5 5c1.2 0 2.4.6 3 1.6.6-1 1.8-1.6 3-1.6 1.8 0 3.5 1.7 3.5 3.5 0 3.2-2.9 5.7-6.3 9.2l-.6.6z" fill="rgba(255,255,255,0.08)" />
      </svg>
    </button>
    <h1 class="q">Ù‡Ù„ Ø£Ù†ØªÙ Ø²ÙˆØ²ÙŠ Ø§Ù„Ø­Ù„ÙˆØ© ØŸØŸ</h1>
    <p class="sub">Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù„Ø¨ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© â€” Ø³ÙŠØ³Ù…Ø­ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª</p>
  </div>
</div>

<div class="rotate" id="rotatePrompt" role="dialog" aria-modal="true" aria-labelledby="rotateTitle">
  <div class="rotate-inner">
    <h2 id="rotateTitle">Ø¹Ù…Ø±ÙŠ Ù…Ù† ÙØ¶Ù„ÙƒØŒ Ù‚ÙˆÙ…ÙŠ Ø¨ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù‡Ø§ØªÙ</h2>
    <p>Ø­ÙˆÙ‘Ù„ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ Ù„ÙŠØ¨Ø¯Ø£ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆÙŠÙØ¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø£Ø³ÙÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø­Ø±ÙˆÙ ØªØªÙƒØ´Ù ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§.</p>
  </div>
</div>

<div class="player" id="playerLayer">
  <video id="vid"
         preload="auto"
         playsinline
         webkit-playsinline
         x5-playsinline
         controlslist="nodownload noremoteplayback"
         controls>
    <source src="themes/sorry-message/assets/video.mp4" type="video/mp4" />
    Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
  </video>

<div id="scroll-container" class="blocktext">
  <div class="typed-line" id="typed"></div><span class="cursor" id="cursor"></span>
</div>

</div>

<!-- server-injected message placeholder (will be replaced by backend). Placed inside an HTML comment
  so raw backend text (including newlines or characters) won't be parsed as HTML/JS by the browser. -->
<div id="server-message" style="display:none"><!-- Ø±ÙˆØ­ Ù…Ù†ØªØ¸Ø± ØŒ ÙˆØ§Ù„Ù„Ù‡ Ø§Ø­Ø¨Ø¬ ÙƒÙ„Ø´ Ù‡ÙˆØ§ÙŠ ÙŠÙˆÙ… Ø¹Ù† ÙŠÙˆÙ… Ø­Ø¨ÙŠ ÙŠØ²ÙŠØ¯ Ø§Ù„Ùƒ â™¥ï¸â™¥ï¸ğŸ«‚--></div>


    
<!-- Trigger button -->
<button id="warningTrigger" style="
  position: fixed;
  top: 20px;
  left: 20px;
  width: 18px; 
  height: 18px;
  border-radius: 50%;
  border: 2px solid #fff;
  color: #fff;
  background: transparent;
  display: grid;
  place-items: center;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  font-size: 12px;
  z-index: 100001;
  animation: pulse 1.5s infinite;
  pointer-events: auto; /* ensure it can receive mouse events */
  
">
  <i class="fas fa-exclamation"></i>
</button>

<!-- Popup overlay -->
<div id="popupOverlay" style="
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  z-index: 100000;
">

  <!-- Glass card -->
  <div id="popupCard" style="
    width: 100%;
    max-width: 420px;
    background: rgba(255,255,255,0.6);
    backdrop-filter: blur(8px);
    border-radius: 18px;
    padding: 28px;
    text-align: right;
    direction: rtl;
    position: relative;
    box-shadow: 0 20px 40px rgba(0,0,0,0.35), 0 0 80px rgba(255,255,255,0.05);
    transform: scale(0.95);
    opacity: 0;
    transition: all 0.25s ease-out;
    z-index: 100001;
  ">

    <!-- Close button on right -->
    <button id="closePopup" style="
      position: absolute;
      top: 12px;
      right: 12px;
      border: none;
      background: transparent;
      color: #111;
      font-size: 18px;
      cursor: pointer;
      z-index: 100002;
      pointer-events: auto;
    ">
      <i class="fas fa-times"></i>
    </button>

    <p style="margin:0 0 16px; font-size:16px; color:#111; line-height:1.6;">
      ØªÙ… Ø§Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‡Ø¯ÙŠØ© Ù„Ù„Ø­Ù„ÙˆØ© Ø²ÙˆØ²ÙŠ â™¥ï¸
    </p>

    <p style="margin:0 0 16px; font-size:16px; color:#111; line-height:1.6;">
      Ù„Ù„Ù…Ø²ÙŠØ¯ ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± .
    </p>

    <!-- Buttons -->
    <div style="display:flex; justify-content:center; gap:12px; width:100%; margin-top:20px; flex-wrap:wrap;">
      <a href="https://t.me/rr8r9" target="_blank" style="
        flex:1 1 140px;
        text-align:center;
        padding:12px 20px;
        border-radius:10px;
        background:#1e90ff;
        color:#fff;
        font-weight:700;
        font-size:16px;
        text-decoration:none;
        pointer-events: auto;
        transition: all 0.2s ease;
      " onmouseover="this.style.transform='scale(1.05)';" onmouseout="this.style.transform='scale(1)';">
        
      </a>

      <!-- WhatsApp button removed per request -->
    </div>

    <small style="display:block; margin-top:16px; font-size:13px; color:#111;">
      Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†Ø­Ù† ØºÙŠØ± Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø§Ø·Ø¦ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹
    </small>
  </div>
</div>

<!-- Inline JS -->
<script>
  const trigger = document.getElementById('warningTrigger');
  const overlay = document.getElementById('popupOverlay');
  const card = document.getElementById('popupCard');
  const closeBtn = document.getElementById('closePopup');

  function showPopup() {
    overlay.style.display = 'flex';
    card.style.animation = 'floatIn 0.3s ease-out forwards';
  }

  function hidePopup() {
    card.style.animation = 'none';
    card.style.transform = 'scale(0.95)';
    card.style.opacity = '0';
    setTimeout(() => { overlay.style.display = 'none'; }, 250);
  }

  trigger.addEventListener('click', showPopup);
  closeBtn.addEventListener('click', hidePopup);
  overlay.addEventListener('click', e => { if(e.target===overlay) hidePopup(); });
  document.addEventListener('keydown', e => { if(e.key==='Escape') hidePopup(); });
</script>

<script>
(() => {
  const heartBtn = document.getElementById('heartBtn');
  const stage = document.getElementById('stage');
  const rotatePrompt = document.getElementById('rotatePrompt');
  const playerLayer = document.getElementById('playerLayer');
  const vid = document.getElementById('vid');
  const tickerEl = document.getElementById('scroll-container');
  const typedEl = document.getElementById('typed');
  const cursorEl = document.getElementById('cursor');

  // Prefer server-injected message placed into #server-message by the backend.
  // Backend replaces the literal string "Ù‡Ù†Ø§ Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ ØªØ±Ø³Ù„Ù‡Ø§ Ø§Ù†Øª Ø§Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø± Ø¹Ù†Ø¯ Ø´Ø±Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·" with the stored message when serving the page.
  const serverMsgEl = document.getElementById('server-message');
  const fallbackMessage = `Ø­Ø¨ÙŠØ¨ØªÙŠ Ø§Ù„ØºØ§Ù„ÙŠØ©ØŒ
Ø£ÙƒØªØ¨ Ù„Ùƒ ÙˆÙ‚Ù„Ø¨ÙŠ Ø¨ÙŠÙ† ÙŠØ¯ÙŠØŒ Ù…Ø«Ù‚Ù„ Ø¨Ø§Ù„Ø­Ù†ÙŠÙ† ÙˆØ§Ù„Ù†Ø¯Ù…ØŒ ØªØ§Ø¦Ù‡ Ø¨ÙŠÙ† ÙƒÙ„Ù…Ø§ØªÙŠ Ø§Ù„ØªÙŠ Ù„Ø§ ØªÙ„ÙŠÙ‚ Ø¨ÙƒÙ Ù…Ù‡Ù…Ø§ Ø­Ø§ÙˆÙ„Øª ØªØ¬Ù…ÙŠÙ„Ù‡Ø§.
Ø£Ø¹ØªØ°Ø± Ø¥Ù† Ù‚ØµÙ‘Ø±ØªØŒ Ø¥Ù† ØªØ±ÙƒØª Ù„Ù„Ø­Ø¸Ø© Ø²Ø¹Ù„Ù‹Ø§ ÙŠØ¹ÙƒÙ‘Ø± ØµÙÙˆ Ø­Ø¨Ù‘Ù†Ø§ØŒ Ø£Ø¹ØªØ°Ø± Ù„Ø£Ù†Ù†ÙŠ Ù†Ø³ÙŠØª Ø£Ù† Ù‚Ù„Ø¨Ùƒ ÙˆØ·Ù† Ù„Ø§ ÙŠÙØºØ§Ø¯Ø±ØŒ ÙˆØ£Ù† ØºÙŠØ§Ø¨Ùƒ ÙˆØ¬Ø¹ Ù„Ø§ ÙŠÙØ­ØªÙ…Ù„.

ÙŠØ§ ÙˆØ±Ø¯Ø© Ø¹Ù…Ø±ÙŠØŒ ÙŠØ§ Ù†Ø¨Ø¶ Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ³Ø± Ø§Ø¨ØªØ³Ø§Ù…ØªÙŠØŒ
Ù„Ùˆ ØªØ¹Ù„Ù…ÙŠÙ† ÙƒÙ… Ø£ÙØªÙ‚Ø¯Ùƒ Ø§Ù„Ø¢Ù†ØŒ ÙƒÙ… Ø£Ø´ØªØ§Ù‚ Ù„ØµÙˆØªÙƒØŒ ÙˆÙ„Ù…Ø³Ø© ÙŠØ¯ÙƒØŒ ÙˆØ¯ÙØ¡ Ø­Ø¯ÙŠØ«Ùƒ Ø§Ù„Ø°ÙŠ ÙŠÙØ¹ÙŠØ¯ Ù„Ù„Ø­ÙŠØ§Ø© Ù…Ø¹Ù†Ø§Ù‡Ø§.
Ø£Ù†Ø§ Ù„Ø§ Ø£Ø·Ù„Ø¨ Ø³ÙˆÙ‰ Ù†Ø¸Ø±Ø© Ù…Ù†ÙƒÙ ØªÙØ¹ÙŠØ¯ ÙƒÙ„ Ø´ÙŠØ¡ ÙƒÙ…Ø§ ÙƒØ§Ù†ØŒ ØªÙØ·ÙØ¦ Ù†ÙŠØ±Ø§Ù† Ø§Ù„Ø´ÙˆÙ‚ Ø§Ù„ØªÙŠ Ø£Ø­Ø±Ù‚ØªÙ†ÙŠ.`;

  // Read raw server text safely. Prefer the HTML comment node content (safer if backend replaces
  // the placeholder inside the comment). Fall back to textContent if comment is not present.
  let rawServerText = '';
  if (serverMsgEl) {
    const commentNode = Array.from(serverMsgEl.childNodes).find(n => n && n.nodeType === Node.COMMENT_NODE && n.nodeValue && n.nodeValue.trim());
    if (commentNode) {
      rawServerText = commentNode.nodeValue.trim();
    } else {
      rawServerText = (serverMsgEl.textContent || '').trim();
    }
  }

  // Escape HTML to avoid accidental HTML injection from backend content, then convert newlines
  // (CRLF, CR, LF) into <br> so the typewriter will show line breaks correctly.
  function escapeHtml(str) {
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  const fullMessageRaw = rawServerText || fallbackMessage;
  const fullMessageHTML = escapeHtml(fullMessageRaw).replace(/\r\n|\r|\n/g, '<br>');

  // Arabic-safe HTML typewriter
  function typeArabicHTML(container, html, speed = 45, onDone) {
    container.innerHTML = "";
    const tempDiv = document.createElement("div");
    tempDiv.innerHTML = html;
    const nodes = [];
    function collect(node) {
      if (node.nodeType === Node.TEXT_NODE) {
        nodes.push({ type: "text", text: node.textContent });
      } else if (node.nodeType === Node.ELEMENT_NODE) {
        const clone = node.cloneNode(false);
        nodes.push({ type: "element", element: clone, children: Array.from(node.childNodes) });
      }
    }
    tempDiv.childNodes.forEach(collect);

    function typeNode(idx = 0) {
      if (idx >= nodes.length) { if (onDone) onDone(); return; }
      const node = nodes[idx];
      if (node.type === "text") {
        const span = document.createElement("span");
        container.appendChild(span);
        let i = 0;
        (function typeChar() {
          if (i < node.text.length) {
            span.textContent += node.text[i++];
            tickerEl.scrollTop = tickerEl.scrollHeight;
            setTimeout(typeChar, speed);
          } else { typeNode(idx + 1); }
        })();
      } else {
        container.appendChild(node.element);
        if (node.children.length > 0) {
          const childHTML = node.children.map(c => c.outerHTML || c.textContent).join('');
          typeArabicHTML(node.element, childHTML, speed, () => typeNode(idx + 1));
        } else { typeNode(idx + 1); }
      }
    }
    typeNode();
  }

  const isMobile = () => window.matchMedia && window.matchMedia('(pointer: coarse)').matches;
  function isLandscape() {
    if (window.matchMedia) {
      const mq = window.matchMedia("(orientation: landscape)");
      if (mq && typeof mq.matches === 'boolean') return mq.matches;
    }
    return window.innerWidth > window.innerHeight;
  }

  async function primeAudio() {
    try { vid.muted = false; await vid.play(); vid.pause(); }
    catch { try { vid.muted = true; await vid.play(); vid.pause(); vid.muted = false; } catch {} }
  }

  heartBtn.addEventListener('click', async () => {
    await primeAudio();
    stage.classList.add('hidden');

    // Desktop/laptop: start immediately. Mobile: require landscape.
    if (!isMobile() || isLandscape()) {
      startPlayback();
    } else {
      rotatePrompt.style.display = 'flex';
    }
  }, { passive: true });

  function onViewportChange() {
    if (playerStarted) return;
    if (rotatePrompt.style.display !== 'none' && isLandscape()) startPlayback();
  }
  window.addEventListener('orientationchange', onViewportChange);
  window.addEventListener('resize', onViewportChange);

  let playerStarted = false;

  async function startPlayback() {
    playerStarted = true;
    rotatePrompt.style.display = 'none';
    playerLayer.style.display = 'block';
    try { vid.currentTime = 0; } catch {}
    try { await vid.play(); }
    catch { try { vid.muted = true; await vid.play(); setTimeout(()=>{vid.muted=false;},300);} catch{} }

    typeArabicHTML(typedEl, fullMessageHTML, 45, () => { cursorEl.style.opacity='1'; });
  }

  // Only block touch scroll on mobile while player visible
  document.addEventListener('touchmove', (e)=>{
    if (isMobile() && playerLayer.style.display==='block') e.preventDefault();
  }, {passive:false});
})();
</script>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" /><script>
        function closePreviewBanner() {
            const banner = document.getElementById('previewBanner');
            banner.style.animation = 'slideUp 0.3s ease-in';
            
            setTimeout(() => {
                banner.style.display = 'none';
                document.body.classList.remove('preview-active');
            }, 300);
        }

        // Always show the banner on page load
        window.addEventListener('DOMContentLoaded', () => {
            document.body.classList.add('preview-active');
        });

        // Optional: Close on ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closePreviewBanner();
            }
        });
    </script>
</body>

</body>
</html>
